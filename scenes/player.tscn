[gd_scene load_steps=6 format=3 uid="uid://c1232bb68fhy6"]

[ext_resource type="Shader" path="res://scenes/player.gdshader" id="1_3ck3v"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_der1l"]
shader = ExtResource("1_3ck3v")

[sub_resource type="GDScript" id="GDScript_dy3ap"]
script/source = "extends CharacterBody2D

@export var speed = 300.0
@export var tilt_speed = 5.0
@export var max_tilt_angle = 15.0
@export var bounce_height = 10
@export var bounce_speed = 10.0

@onready var color_rect = $ColorRect
@onready var collision_shape = $CollisionShape2D

var tilt_angle = 0.0
var time = 0.0
var initial_rect_position

func _ready():
	initial_rect_position = color_rect.position

func _physics_process(delta):
	var direction = Input.get_vector(\"ui_left\", \"ui_right\", \"ui_up\", \"ui_down\")
	velocity = direction * speed
	
	move_and_slide()
	
	time += delta
	var bounce_offset = 1 + sin(bounce_speed*time)/(2*bounce_height)
	$ColorRect.scale = Vector2(1, -bounce_offset)
	
	# Tilt logic
	var target_tilt = 0.0
	if direction.x != 0:
		target_tilt = direction.x * max_tilt_angle
	
	tilt_angle = lerp(tilt_angle, target_tilt, tilt_speed * delta)
	rotation_degrees = tilt_angle
	
	# Idle bounce
	if direction == Vector2.ZERO:
		var bounce_offset_jump = sin(time * bounce_speed) * bounce_height/16
		color_rect.position = initial_rect_position + Vector2(0, bounce_offset_jump)
	else:
		color_rect.position = initial_rect_position

func _process(delta):
	# Smooth color change based on movement
	var speed_factor = velocity.length() / speed
	var r = lerp(1.0, 0.5, speed_factor)
	var g = lerp(1.0, 0.7, speed_factor)
	var b = lerp(1.0, 1.0, speed_factor)
	#color_rect.color = Color(r, g, b)
"

[sub_resource type="Gradient" id="Gradient_dg3yn"]
offsets = PackedFloat32Array(0, 0.441704, 0.847534, 1)
colors = PackedColorArray(0.179995, 0.181356, 0.123274, 1, 0.975336, 0.975336, 0.975336, 1, 0.976644, 0.976644, 0.976644, 1, 1, 1, 1, 1)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_y4exp"]
size = Vector2(38, 64)

[node name="player" type="CharacterBody2D"]
material = SubResource("ShaderMaterial_der1l")
motion_mode = 1
wall_min_slide_angle = 0.441568
script = SubResource("GDScript_dy3ap")

[node name="CPUParticles2D" type="CPUParticles2D" parent="."]
position = Vector2(2, -48)
amount = 20
lifetime = 0.4
randomness = 1.0
lifetime_randomness = 1.0
emission_shape = 1
emission_sphere_radius = 15.0
direction = Vector2(0, 1)
spread = 20.0
gravity = Vector2(0, 0)
scale_amount_min = 5.0
scale_amount_max = 10.0
color = Color(0.823245, 0.945324, 0.993273, 1)
color_ramp = SubResource("Gradient_dg3yn")

[node name="ColorRect" type="ColorRect" parent="."]
offset_left = -20.0
offset_top = -34.0
offset_right = 22.0
offset_bottom = 34.0

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(1, 0)
shape = SubResource("RectangleShape2D_y4exp")

[node name="Sprite2D" type="Sprite2D" parent="."]
